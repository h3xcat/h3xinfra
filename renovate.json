{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    ":dependencyDashboard",
    ":semanticCommits",
    ":separateMajorReleases",
    "docker:enableMajor",
    "helpers:pinGitHubActionDigests"
  ],
  "prConcurrentLimit": 5,
  "prHourlyLimit": 2,
  "timezone": "America/Los_Angeles",
  "labels": [
    "dependencies"
  ],
  "commitMessagePrefix": "chore(deps):",
  "rangeStrategy": "bump",
  "minimumReleaseAge": "3 days",
  "vulnerabilityAlerts": {
    "labels": [
      "security"
    ],
    "automerge": true
  },
  "packageRules": [
    {
      "description": "Group all Helm chart updates together",
      "matchDatasources": [
        "helm"
      ],
      "groupName": "Helm charts"
    },
    {
      "description": "Group all Docker image updates together",
      "matchDatasources": [
        "docker"
      ],
      "groupName": "Docker images"
    },
    {
      "description": "Automerge patch updates for non-major dependencies",
      "matchUpdateTypes": [
        "patch",
        "pin",
        "digest"
      ],
      "automerge": true,
      "automergeType": "pr",
      "platformAutomerge": true
    },
    {
      "description": "Group Kubernetes-related updates",
      "groupName": "Kubernetes",
      "schedule": [
        "before 10am on monday"
      ],
      "matchPackageNames": [
        "/^kubernetes/",
        "/^k8s/",
        "/kubectl/",
        "/^k3s/"
      ]
    },
    {
      "description": "Group Cilium updates",
      "groupName": "Cilium",
      "schedule": [
        "before 10am on monday"
      ],
      "matchPackageNames": [
        "/^cilium/"
      ]
    }
  ],
  "customManagers": [
    {
      "customType": "regex",
      "description": "Update Docker images in Helm values files (nested image.repository + image.tag)",
      "managerFilePatterns": [
        "/(^|/)charts/.+/values\\.ya?ml$/"
      ],
      "matchStrings": [
        "image:\\s*\\n\\s*repository:\\s*[\"']?(?<depName>[^\\s\"'\\n]+)[\"']?\\s*\\n\\s*tag:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "datasourceTemplate": "docker"
    },
    {
      "customType": "regex",
      "description": "Update Docker images in Helm values (images block with nested containers)",
      "managerFilePatterns": [
        "/(^|/)charts/.+/values\\.ya?ml$/"
      ],
      "matchStrings": [
        "repository:\\s*[\"']?(?<depName>(?:lscr\\.io|ghcr\\.io|docker\\.io|quay\\.io)[^\\s\"'\\n]+)[\"']?\\s*\\n\\s*tag:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "datasourceTemplate": "docker"
    },
    {
      "customType": "regex",
      "description": "Update Docker images (simple repo/tag pattern)",
      "managerFilePatterns": [
        "/(^|/)charts/.+/values\\.ya?ml$/"
      ],
      "matchStrings": [
        "repository:\\s*[\"']?(?<depName>plexinc/[^\\s\"'\\n]+)[\"']?\\s*\\n\\s*tag:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "datasourceTemplate": "docker"
    },
    {
      "customType": "regex",
      "description": "Update Cilium chart version in inventory",
      "managerFilePatterns": [
        "/(^|/)inventory/.+/host_vars/.+/cilium\\.ya?ml$/"
      ],
      "matchStrings": [
        "chart_version:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "depNameTemplate": "cilium",
      "registryUrlTemplate": "https://helm.cilium.io",
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex",
      "description": "Update MetalLB chart version in inventory",
      "managerFilePatterns": [
        "/(^|/)inventory/.+/host_vars/.+/metallb\\.ya?ml$/"
      ],
      "matchStrings": [
        "chart_version:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "depNameTemplate": "metallb",
      "registryUrlTemplate": "https://metallb.github.io/metallb",
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex",
      "description": "Update cert-manager chart version in inventory",
      "managerFilePatterns": [
        "/(^|/)inventory/.+/host_vars/.+/certmanager\\.ya?ml$/"
      ],
      "matchStrings": [
        "chart_version:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "depNameTemplate": "cert-manager",
      "registryUrlTemplate": "https://charts.jetstack.io",
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex",
      "description": "Update external-dns chart version in inventory",
      "managerFilePatterns": [
        "/(^|/)inventory/.+/host_vars/.+/externaldns\\.ya?ml$/"
      ],
      "matchStrings": [
        "chart_version:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "depNameTemplate": "external-dns",
      "registryUrlTemplate": "https://kubernetes-sigs.github.io/external-dns",
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex",
      "description": "Update ingress-nginx chart version in inventory",
      "managerFilePatterns": [
        "/(^|/)inventory/.+/host_vars/.+/ingressnginx\\.ya?ml$/"
      ],
      "matchStrings": [
        "chart_version:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "depNameTemplate": "ingress-nginx",
      "registryUrlTemplate": "https://kubernetes.github.io/ingress-nginx",
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex",
      "description": "Update Longhorn chart version in inventory",
      "managerFilePatterns": [
        "/(^|/)inventory/.+/host_vars/.+/longhorn\\.ya?ml$/"
      ],
      "matchStrings": [
        "chart_version:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "depNameTemplate": "longhorn",
      "registryUrlTemplate": "https://charts.longhorn.io",
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex",
      "description": "Update csi-driver-smb chart version in inventory",
      "managerFilePatterns": [
        "/(^|/)inventory/.+/host_vars/.+/smb\\.ya?ml$/"
      ],
      "matchStrings": [
        "chart_version:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "depNameTemplate": "csi-driver-smb",
      "registryUrlTemplate": "https://raw.githubusercontent.com/kubernetes-csi/csi-driver-smb/master/charts",
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex",
      "description": "Update Mailu chart version in inventory",
      "managerFilePatterns": [
        "/(^|/)inventory/.+/host_vars/.+/mailu\\.ya?ml$/"
      ],
      "matchStrings": [
        "chart_version:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "depNameTemplate": "mailu",
      "registryUrlTemplate": "https://mailu.github.io/helm-charts",
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex",
      "description": "Update Open WebUI chart version in inventory",
      "managerFilePatterns": [
        "/(^|/)inventory/.+/host_vars/.+/openwebui\\.ya?ml$/"
      ],
      "matchStrings": [
        "chart_version:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "depNameTemplate": "open-webui",
      "registryUrlTemplate": "https://helm.openwebui.com",
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex",
      "description": "Update OAuth2-proxy chart version in standup files",
      "managerFilePatterns": [
        "/(^|/)playbooks/.+/standup.*\\.ya?ml$/"
      ],
      "matchStrings": [
        "chart_ref:\\s*[\"']?oauth2-proxy/oauth2-proxy[\"']?\\s*\\n\\s*chart_version:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "depNameTemplate": "oauth2-proxy",
      "registryUrlTemplate": "https://oauth2-proxy.github.io/manifests",
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex",
      "description": "Update Authentik chart version in standup files",
      "managerFilePatterns": [
        "/(^|/)playbooks/.+/standup.*\\.ya?ml$/"
      ],
      "matchStrings": [
        "chart_ref:\\s*[\"']?goauthentik/authentik[\"']?\\s*\\n\\s*chart_version:\\s*[\"']?(?<currentValue>[^\\s\"'\\n]+)[\"']?"
      ],
      "depNameTemplate": "authentik",
      "registryUrlTemplate": "https://charts.goauthentik.io",
      "datasourceTemplate": "helm"
    },
    {
      "customType": "regex",
      "description": "Update kubectl version in Dockerfile",
      "managerFilePatterns": [
        "/(^|/)\\.devcontainer/Dockerfile$/"
      ],
      "matchStrings": [
        "curl -LO \"https://dl\\.k8s\\.io/release/v(?<currentValue>[^/]+)/bin/linux/amd64/kubectl\""
      ],
      "depNameTemplate": "kubernetes/kubernetes",
      "datasourceTemplate": "github-releases",
      "extractVersionTemplate": "^v(?<version>.+)$"
    },
    {
      "customType": "regex",
      "description": "Update Helm in Dockerfile",
      "managerFilePatterns": [
        "/(^|/)\\.devcontainer/Dockerfile$/"
      ],
      "matchStrings": [
        "curl https://raw\\.githubusercontent\\.com/helm/helm/(?<currentValue>v[^/]+)/scripts/get-helm-3"
      ],
      "depNameTemplate": "helm/helm",
      "datasourceTemplate": "github-releases"
    },
    {
      "customType": "regex",
      "description": "Update base devcontainer image",
      "managerFilePatterns": [
        "/(^|/)\\.devcontainer/Dockerfile$/"
      ],
      "matchStrings": [
        "ARG BASE_IMAGE_NAME=(?<depName>[^\\n]+)\\nARG BASE_IMAGE_TAG=(?<currentValue>[^\\n]+)"
      ],
      "datasourceTemplate": "docker"
    }
  ],
  "hostRules": [
    {
      "description": "Increase timeout for slow Helm registries",
      "matchHost": "helm.cilium.io",
      "timeout": 60000
    },
    {
      "description": "Increase timeout for GitHub Container Registry",
      "matchHost": "ghcr.io",
      "timeout": 30000
    }
  ]
}
